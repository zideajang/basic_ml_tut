今天我们来学习 EM 我么看到变化背后隐含变量。

![task.jpg](https://upload-images.jianshu.io/upload_images/8207483-accde6b60e6e93b9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

鸣人(B)和佐助(C)完成任务，具体是由谁完成任务是卡卡西(A)进行分别的，将任务分配给鸣人的概率为(pi)如果卡卡西(A)指派鸣人(B)来完成任务,他完成任务概率为 p ，如果是佐助(B)完成任务概率为 q。那么我们看到结果受到隐含变量 A 的影响。

$$\begin{aligned}
    P(Y|\theta) = \prod_i^N P(y^{(i)}|\theta) \\
    = \prod_i^N \pi p^{y^{(i)}}(1-p)^{1-y^{(i)}} + (1 - \pi) q^{y^{(i)}}(1-q)^{1-y^{(i)}} \\
    = \sum_{i=1}^N \log P(y^{(i)}|\theta)
\end{aligned}$$

上面公式应该不难理解，假设概率是独立的，可以通过假设 B 的概率为 $\pi$ 那么对于 $y^{(i)}$ ，如果  $y^{(i)}$ 等于 1 那么概率就是 B 完成任务概率就是 q 如果$y^{(i)}$ 等于 0 概率也就是 1 - q。

我们需要求出$\pi,p,q$ 概率，完成任务用 1 表示而 0 表示失败。如果我们假设知道每一次任务是由 B 和 C 谁来完成任务的话，问题就简单了。如下表

| B  | B  | B |C  | C  | C | B  | C  | B |
|---|---|---|---|---|---|---|---|---|---|
|  1 | 1  | 0  | 1  | 0  |  1 | 1  | 0  | 0  | 1  |


有了上面已知条件，这件事给定参数$\pi,p,q$ 参数

$$\begin{cases}
    p = \frac{count(1)}{naruto} \\
    q = \frac{count(1)}{sasuke}
\end{cases}$$
上面分别是，也就是找到任务中多少个是鸣人(naruto)来完成，1 表示鸣人成功完成任务的个数，也就是 p
$$\pi = \frac{naruto}{naruto + sasuke} = \frac{naruto}{N}$$

下面是 pi 的估计 N 表示任务数量，其中由鸣人(naruto)完成任务数占总任务数的比就是 pi。

所以我们需要对每一次结果来推测这个任务是 B 还是 C 完成，我们可以近似估计.

| B  | B  | B |C  | C  | C | B  | C  | B |
|---|---|---|---|---|---|---|---|---|---|
|  1 | 1  | 0  | 1  | 0  |  1 | 1  | 0  | 0  | 1  |
|  0.5 | 0.3  | 0.2  | 0.3  | 0.2  |  0.3 | 0.3  | 0.2  | 0.2  | 0.3  |

最后一行使我们在不知道每一次任务具体事由随来做的时候，对该次任务是由鸣人完成的概率推测。

---
我们来看一下，这里我们每一次任务是鸣人还是由佐助来完成任务是不确定的，这里$\pi$表示任务是由鸣人来完成的概率。这里$\mu_j$ 表示第 j 次结果是由于鸣人完成的概率。

$$\mu_j =  \frac{\pi p^{y^{(j)}}(1-p)^{1-y^{(j)}} }{ \pi p^{y^{(j)}}(1-p)^{1-y^{(j)}} + (1 - \pi) q^{y^{(j)}}(1-q)^{1-y^{(j)}}}$$
- $\pi y^{(j)}(1-p)^{1-y^{(j)}}$ 

$$\begin{cases}
    \pi = \frac{1}{N} \sum_{j=1}^N \mu_j \\
    p = \frac{\sum_{j=1}^N y^{(j)} \mu_j}{\sum_{j=1}^N \mu_j} \\
    p = \frac{\sum_{j=1}^N y^{(j)} (1 - \mu_j)}{\sum_{j=1}^N (1 - \mu_j)} 
\end{cases}$$
- 我们知道$\mu_j$ 鸣人完成任务可能性，$\pi$ 表示鸣人完成任务概率，也就是如果 $\pi = 0.3$ 也就是 100 任务其中 30 是由鸣人完成。
- 那么我们将每次可能由鸣人来完成任务的概率分别是$\mu_j$将这些$\mu_j$概率求和除以N就可以得到$\pi$
- p 是鸣人完成任务概率，那么每一次由鸣人来完成任务概率为$\mu_j$, 那么每一次我们观察到$y^{(j)}$ 乘以$\mu_j$ 的和除以$\mu_j$概率就是鸣人完成任务概率。

